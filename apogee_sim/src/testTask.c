#include "../include/sim_Drag/SimMathDrag.h"
#include "../include/tasks.h"

extern QueueHandle_t dataQueue;
extern TaskHandle_t dataTask;

void testTask(void *arg)
{

	float time[168] = {
		151266, 151318, 151387, 151476, 151544, 151748, 152275, 152622, 152755,
		152813, 152865, 152918, 152970, 153028, 153080, 153132, 153190, 153242,
		153320, 153384, 153442, 153494, 153546, 153604, 153656, 153708, 153761,
		153819, 153870, 153935, 153993, 154045, 154097, 154149, 154207, 154259,
		154311, 154369, 154420, 154472, 154530, 154582, 154634, 154686, 154769,
		154823, 154875, 154944, 154996, 155048, 155100, 155157, 155209, 155261,
		155318, 155370, 155422, 155474, 155531, 155583, 155635, 155693, 155745,
		155797, 155849, 155933, 155985, 156037, 156094, 156146, 156198, 156250,
		156308, 156360, 156412, 156470, 156534, 156586, 156638, 156696, 156747,
		156799, 156857, 156909, 156961, 157019, 157070, 157122, 157174, 157244,
		157296, 157360, 157418, 157470, 157523, 157575, 157632, 157684, 157736,
		157805, 157859, 157911, 157963, 158020, 158072, 158124, 158182, 158234,
		158286, 158338, 158396, 158448, 158525, 158583, 158635, 158687, 158739,
		158797, 158849, 158901, 158959, 159011, 159063, 159115, 159173, 159225,
		159277, 159335, 159387, 159439, 159491, 159549, 159601, 159665, 159723,
		159786, 159838, 159890, 159948, 160000, 160052, 160110, 160162, 160214,
		160266, 160330, 160382, 160434, 160504, 160556, 160608, 160685, 160737,
		160789, 160841, 160907, 160960, 161012, 161069, 161147, 161199, 161251,
		161308, 161360, 161412, 161469, 161521, 161573,
	};
	float height[168] = {
		-1.462,	 -1.462,  -1.031,  -0.839,	1.006,	 8.377,	  43.759,  84.192,
		109.571, 122.349, 135.882, 135.882, 147.578, 160.609, 160.609, 173.048,
		185.65,	 185.65,  198.853, 210.223, 223.677, 223.677, 235.188, 247.433,
		247.433, 259.47,  270.954, 270.954, 283.098, 293.802, 305.661, 305.661,
		316.613, 327.446, 327.446, 339.731, 350.082, 350.082, 360.241, 371.491,
		371.491, 381.664, 392.506, 392.506, 403.232, 412.679, 422.51,  433.58,
		433.58,	 442.883, 442.883, 452.854, 462.379, 462.379, 471.778, 481.912,
		490.96,	 490.96,  500.216, 509.362, 509.362, 518.471, 527.123, 527.123,
		536.285, 545.185, 553.026, 553.026, 562.057, 570.12,  570.12,  578.807,
		586.668, 586.668, 595.623, 602.622, 602.622, 610.504, 618.92,  618.92,
		627.029, 634.6,	  634.6,   641.647, 649.387, 649.387, 656.985, 663.743,
		663.743, 671.253, 678.73,  685.779, 685.779, 692.438, 699.548, 699.548,
		705.954, 712.65,  712.65,  719.637, 726.072, 732.279, 732.279, 738.715,
		744.828, 744.828, 750.908, 757.14,	757.14,	 763.704, 768.976, 768.976,
		774.959, 780.402, 785.564, 785.564, 791.152, 797.055, 797.055, 802.014,
		806.987, 806.987, 812.312, 817.564, 817.564, 822.519, 827.717, 827.717,
		831.842, 837.466, 837.466, 842.566, 847.626, 852.043, 852.043, 856.72,
		861.073, 861.073, 865.25,  870.204, 870.204, 874.047, 878.809, 878.809,
		883.127, 887.136, 890.972, 890.972, 889.73,	 902.028, 902.028, 907.126,
		912.532, 915.264, 915.264, 913.329, 913.606, 913.606, 916.428, 918.734,
		923.426, 923.426, 926.682, 947.859, 947.859, 971.55,  963.755, 963.755,
	};
	MeasuredData testData;
	size_t i = 0;
	xTaskNotifyGive(dataTask);
	while (i < 168)
	{
		testData.height = height[i];
		testData.timeInMS = (float)((float)time[i] - time[0]);
        testData.breakAngle = 0.0f;
		xQueueSend(dataQueue, (void *)&testData, 10);
		vTaskDelay(50 / portTICK_PERIOD_MS);
		i++;
	}
    while(1)
    {
        ESP_LOGI(pcTaskGetName(NULL), "SIMULATION END\n");
        vTaskDelay(500 / portTICK_PERIOD_MS);
    }
}